/* Built: Tue 14 Jun 2011 18:43:31 BST */
/*
 * OverlappingMarkerSpiderfier
 * https://github.com/jawj/OverlappingMarkerSpiderfier
 *
 * Copyright (c) 2011 George MacKerron
 * Released under the MIT licence: http://opensource.org/licenses/mit-license
 */
(function(){var l=null;
(function(){function n(a,h){return function(){return a.apply(h,arguments)}}var q=Array.prototype.slice;this.OverlappingMarkerSpiderfier=function(){function a(c){var d,e,b;this.map=c;this.i=new this.constructor.b(this.map);this.d=[];this.f={};b=["click","zoom_changed","maptypeid_changed"];d=0;for(e=b.length;d<e;d++)c=b[d],h.event.addListener(this.map,c,n(function(){return this.m()},this))}var h,k,o,i,p;h=google.maps;i=h.MapTypeId;p=Math.PI*2;a.prototype.VERSION="0.1";a.prototype.nearbyDistance=20;
a.prototype.circleSpiralSwitchover=9;a.prototype.circleFootSeparation=23;a.prototype.circleStartAngle=p/12;a.prototype.spiralFootSeparation=26;a.prototype.spiralLengthStart=11;a.prototype.spiralLengthFactor=4;a.prototype.usualZIndex=10;a.prototype.spiderfiedZIndex=1E4;a.prototype.usualLegZIndex=9;a.prototype.highlightedLegZIndex=9999;a.prototype.legWeight=1.5;a.prototype.legColors={usual:{},highlighted:{}};o=a.prototype.legColors.usual;k=a.prototype.legColors.highlighted;o[i.HYBRID]=o[i.SATELLITE]=
"#fff";k[i.HYBRID]=k[i.SATELLITE]="#f00";o[i.TERRAIN]=o[i.ROADMAP]="#444";k[i.TERRAIN]=k[i.ROADMAP]="#f00";a.prototype.addListener=function(c,d){var e,b;((b=(e=this.f)[c])!=l?b:e[c]=[]).push(d);return this};a.prototype.trigger=function(){var f;var c,d,e,b,g;d=arguments[0];c=2<=arguments.length?q.call(arguments,1):[];f=(e=this.f[d])!=l?e:[],d=f;b=0;for(g=d.length;b<g;b++)e=d[b],e.apply(l,c);return this};a.prototype.addMarker=function(c){h.event.addListener(c,"click",n(function(){return this.w(c)},
this));c.setZIndex(this.usualZIndex);this.d.push(c);return this};a.prototype.t=function(c,d){var e,b,g,a,j,h,i,m;a=[];j=d*d;g=this.g(c.position);m=this.d;h=0;for(i=m.length;h<i;h++)e=m[h],b=this.g(e.position),this.j(b,g)<j&&a.push({r:e,h:b});return a};a.prototype.n=function(c,d){var e,b,a,f,j;f=this.circleFootSeparation*(2+c)/p;b=p/c;j=[];for(a=0;0<=c?a<c:a>c;0<=c?a++:a--)e=this.circleStartAngle+a*b,j.push(new h.Point(d.x+f*Math.cos(e),d.y+f*Math.sin(e)));return j};a.prototype.o=function(c,d){var a,
b,g,f,j;g=this.spiralLengthStart;a=0;j=[];for(b=0;0<=c?b<c:b>c;0<=c?b++:b--)a+=this.spiralFootSeparation/g+b*5.0E-4,f=new h.Point(d.x+g*Math.cos(a),d.y+g*Math.sin(a)),g+=p*this.spiralLengthFactor/a,j.push(f);return j};a.prototype.w=function(c){var d;d=c.a!=l;this.m();return d?this.trigger("click",c):(d=this.t(c,this.nearbyDistance),d.length===1?this.trigger("click",c):this.z(d))};a.prototype.q=function(c){return{e:n(function(){return c.a.c.setOptions({strokeColor:this.legColors.highlighted[this.map.mapTypeId],
zIndex:this.highlightedLegZIndex})},this),l:n(function(){return c.a.c.setOptions({strokeColor:this.legColors.usual[this.map.mapTypeId],zIndex:this.usualLegZIndex})},this)}};a.prototype.z=function(c){var d,a,b,g,f,j,i,k,m;this.k=!0;b=c.length;d=this.u(function(){var a,d,b;b=[];a=0;for(d=c.length;a<d;a++)j=c[a],b.push(j.h);return b}());b=b>=this.circleSpiralSwitchover?this.o(b,d).reverse():this.n(b,d);i=[];k=0;for(m=b.length;k<m;k++){a=b[k];d=this.v(a);f=this.s(c,n(function(c){return this.j(c.h,a)},
this));f=f.r;g=new h.Polyline({map:this.map,path:[f.position,d],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex});f.a={A:f.position,c:g};if(this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId])g=this.q(f),h.event.addListener(f,"mouseover",g.e),h.event.addListener(f,"mouseout",g.l),f.a.p=g;f.setZIndex(this.spiderfiedZIndex+a.y);f.setPosition(d);i.push(f)}return this.trigger("spiderfy",i)};a.prototype.m=
function(){var c,a,e,b,g,f;if(this.k!=l){delete this.k;e=[];f=this.d;b=0;for(g=f.length;b<g;b++)if(a=f[b],a.a!=l)a.a.c.setMap(l),a.setZIndex(this.usualZIndex),a.setPosition(a.a.A),c=a.a.p,c!=l&&(h.event.clearListeners(a,"mouseover",c.e),h.event.clearListeners(a,"mouseout",c.l)),delete a.a,e.push(a);return this.trigger("unspiderfy",e)}};a.prototype.j=function(a,d){var e,b;e=a.x-d.x;b=a.y-d.y;return e*e+b*b};a.prototype.u=function(a){var d,e,b,g,f;g=e=b=0;for(f=a.length;g<f;g++)d=a[g],e+=d.x,b+=d.y;
a=a.length;return new h.Point(e/a,b/a)};a.prototype.g=function(a){return this.i.getProjection().fromLatLngToDivPixel(a)};a.prototype.v=function(a){return this.i.getProjection().fromDivPixelToLatLng(a)};a.prototype.s=function(a,d){var e,b,g,f,h;g=0;for(h=a.length;g<h;g++)if(f=a[g],f=d(f),!(typeof e!=="undefined"&&e!==l)||f<b)b=f,e=g;return a.splice(e,1)[0]};a.b=function(a){return this.setMap(a)};a.b.prototype=new h.OverlayView;a.b.prototype.draw=function(){};return a}()}).call(this);}).call(this);
