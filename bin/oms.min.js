(function(){var k,i,j,h,l,m=function(a,b){return function(){return a.apply(b,arguments)}},n=Array.prototype.slice;i=google.maps;l=Math.PI*2;k=function(){function a(b){var c,f,d;this.map=b;this.projHelper=new this.constructor.ProjHelper(this.map);this.markers=[];this.listeners={};d=["click","zoom_changed","maptypeid_changed"];c=0;for(f=d.length;c<f;c++)b=d[c],i.event.addListener(this.map,b,m(function(){return this.unspiderfy()},this))}a.prototype.nearbyDistance=20;a.prototype.circleFootSeparation=
23;a.prototype.circleStartAngle=l/12;a.prototype.spiralFootSeparation=26;a.prototype.spiralLengthStart=11;a.prototype.spiralLengthFactor=4;a.prototype.circleSpiralSwitchover=9;a.prototype.usualZIndex=10;a.prototype.spiderfiedZIndex=1E4;a.prototype.usualLegZIndex=9;a.prototype.highlightedLegZIndex=9999;a.prototype.legWeight=1.5;a.prototype.legColors={usual:{},highlighted:{}};a.prototype.addListener=function(b,c){var f,d;((d=(f=this.listeners)[b])!=null?d:f[b]=[]).push(c);return this};a.prototype.trigger=
function(){var e;var b,c,f,d,g;c=arguments[0];b=2<=arguments.length?n.call(arguments,1):[];e=(f=this.listeners[c])!=null?f:[],c=e;d=0;for(g=c.length;d<g;d++)f=c[d],f.apply(null,b);return this};a.prototype.addMarker=function(b){i.event.addListener(b,"click",m(function(){return this.spiderListener(b)},this));b.setZIndex(this.usualZIndex);this.markers.push(b);return this};a.prototype.nearbyMarkerData=function(b,c){var f,d,g,e,a,i,j,h;e=[];a=c*c;g=this.llToPt(b.position);h=this.markers;i=0;for(j=h.length;i<
j;i++)f=h[i],d=this.llToPt(f.position),this.ptDistanceSq(d,g)<a&&e.push({marker:f,markerPt:d});return e};a.prototype.generatePtsCircle=function(b,c){var f,d,g,e,a;e=this.circleFootSeparation*(2+b)/l;d=l/b;a=[];for(g=0;0<=b?g<b:g>b;0<=b?g++:g--)f=this.circleStartAngle+g*d,a.push(new i.Point(c.x+e*Math.cos(f),c.y+e*Math.sin(f)));return a};a.prototype.generatePtsSpiral=function(b,c){var f,d,a,e,h;a=this.spiralLengthStart;f=0;h=[];for(d=0;0<=b?d<b:d>b;0<=b?d++:d--)f+=this.spiralFootSeparation/a+d*5.0E-4,
e=new i.Point(c.x+a*Math.cos(f),c.y+a*Math.sin(f)),a+=l*this.spiralLengthFactor/f,h.push(e);return h};a.prototype.spiderListener=function(b){var c;c=b.omsData!=null;this.unspiderfy();return c?this.trigger("click",b):(c=this.nearbyMarkerData(b,this.nearbyDistance),c.length===1?this.trigger("click",b):this.spiderfy(c))};a.prototype.makeHighlightListeners=function(b){return{highlight:m(function(){return b.omsData.leg.setOptions({strokeColor:this.legColors.highlighted[this.map.mapTypeId],zIndex:this.highlightedLegZIndex})},
this),unhighlight:m(function(){return b.omsData.leg.setOptions({strokeColor:this.legColors.usual[this.map.mapTypeId],zIndex:this.usualLegZIndex})},this)}};a.prototype.spiderfy=function(b){var c,a,d,g,e,h,j,k,l;this.spiderfied=!0;d=b.length;c=this.ptAverage(function(){var c,a,d;d=[];c=0;for(a=b.length;c<a;c++)h=b[c],d.push(h.markerPt);return d}());d=d>=this.circleSpiralSwitchover?this.generatePtsSpiral(d,c).reverse():this.generatePtsCircle(d,c);j=[];k=0;for(l=d.length;k<l;k++){a=d[k];c=this.ptToLl(a);
e=this.minExtract(b,m(function(b){return this.ptDistanceSq(b.markerPt,a)},this));e=e.marker;g=new i.Polyline({map:this.map,path:[e.position,c],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex});e.omsData={usualPosition:e.position,leg:g};if(this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId])g=this.makeHighlightListeners(e),i.event.addListener(e,"mouseover",g.highlight),i.event.addListener(e,"mouseout",
g.unhighlight),e.omsData.hightlightListeners=g;e.setZIndex(this.spiderfiedZIndex+a.y);e.setPosition(c);j.push(e)}return this.trigger("spiderfy",j)};a.prototype.unspiderfy=function(){var b,c,a,d,g,e;if(this.spiderfied!=null){delete this.spiderfied;a=[];e=this.markers;d=0;for(g=e.length;d<g;d++)if(c=e[d],c.omsData!=null)c.omsData.leg.setMap(null),c.setZIndex(this.usualZIndex),c.setPosition(c.omsData.usualPosition),b=c.omsData.hightlightListeners,b!=null&&(i.event.clearListeners(c,"mouseover",b.highlight),
i.event.clearListeners(c,"mouseout",b.unhighlight)),delete c.omsData,a.push(c);return this.trigger("unspiderfy",a)}};a.prototype.ptDistanceSq=function(b,c){var a,d;a=b.x-c.x;d=b.y-c.y;return a*a+d*d};a.prototype.ptAverage=function(b){var a,f,d,g,e;g=f=d=0;for(e=b.length;g<e;g++)a=b[g],f+=a.x,d+=a.y;b=b.length;return new i.Point(f/b,d/b)};a.prototype.llToPt=function(b){return this.projHelper.getProjection().fromLatLngToDivPixel(b)};a.prototype.ptToLl=function(b){return this.projHelper.getProjection().fromDivPixelToLatLng(b)};
a.prototype.minExtract=function(b,a){var f,d,g,e,h;g=0;for(h=b.length;g<h;g++)if(e=b[g],e=a(e),!(typeof f!=="undefined"&&f!==null)||e<d)d=e,f=g;return b.splice(f,1)[0]};return a}();k.ProjHelper=function(a){return this.setMap(a)};k.ProjHelper.prototype=new i.OverlayView;k.ProjHelper.prototype.draw=function(){};h=i.MapTypeId;j=k.prototype.legColors;j.usual[h.HYBRID]=j.usual[h.SATELLITE]="#fff";j.highlighted[h.HYBRID]=j.highlighted[h.SATELLITE]="#f00";j.usual[h.TERRAIN]=j.usual[h.ROADMAP]="#444";j.highlighted[h.TERRAIN]=
j.highlighted[h.ROADMAP]="#f00";this.OverlappingMarkerSpiderfier=k}).call(this);
